{"version":3,"file":"index.js","sources":["../src/use-get-editor.ts","../src/editor.tsx","../src/use-editor.ts","../src/use-instance.ts"],"sourcesContent":["import { createContext, useContext, useEffect, useRef } from 'react'\n\nimport type { EditorInfoCtx } from './types'\n\nexport const editorInfoContext = createContext<EditorInfoCtx>(\n  {} as EditorInfoCtx\n)\n\nexport function useGetEditor() {\n  const {\n    dom,\n    editor: editorRef,\n    setLoading,\n    editorFactory: getEditor,\n  } = useContext(editorInfoContext)\n  const domRef = useRef<HTMLDivElement>(null)\n\n  useEffect(() => {\n    const div = domRef.current\n\n    if (!getEditor) return\n\n    if (!div) return\n\n    dom.current = div\n\n    const editor = getEditor(div)\n    if (!editor) return\n\n    setLoading(true)\n    editor\n      .create()\n      .then((editor) => {\n        editorRef.current = editor\n      })\n      .finally(() => {\n        setLoading(false)\n      })\n      .catch(console.error)\n\n    return () => {\n      editor.destroy().catch(console.error)\n    }\n  }, [dom, editorRef, getEditor, setLoading])\n\n  return domRef\n}\n","import type { Editor } from '@milkdown/kit/core'\nimport type { FC, ReactNode } from 'react'\n\nimport React, { useMemo, useRef, useState } from 'react'\n\nimport type { EditorInfoCtx, GetEditor } from './types'\n\nimport { editorInfoContext, useGetEditor } from './use-get-editor'\n\nexport const Milkdown: FC = () => {\n  const domRef = useGetEditor()\n\n  return <div data-milkdown-root ref={domRef} />\n}\n\nexport const MilkdownProvider: FC<{ children: ReactNode }> = ({ children }) => {\n  const dom = useRef<HTMLDivElement | undefined>(undefined)\n  const [editorFactory, setEditorFactory] = useState<GetEditor | undefined>(\n    undefined\n  )\n  const editor = useRef<Editor | undefined>(undefined)\n  const [loading, setLoading] = useState(true)\n\n  const editorInfoCtx = useMemo<EditorInfoCtx>(\n    () => ({\n      loading,\n      dom,\n      editor,\n      setLoading,\n      editorFactory,\n      setEditorFactory,\n    }),\n    [loading, editorFactory]\n  )\n\n  return (\n    <editorInfoContext.Provider value={editorInfoCtx}>\n      {children}\n    </editorInfoContext.Provider>\n  )\n}\n","import type { DependencyList } from 'react'\n\nimport { useCallback, useContext, useLayoutEffect } from 'react'\n\nimport type { GetEditor, UseEditorReturn } from './types'\n\nimport { editorInfoContext } from './use-get-editor'\n\nexport function useEditor(\n  getEditor: GetEditor,\n  deps: DependencyList = []\n): UseEditorReturn {\n  const editorInfo = useContext(editorInfoContext)\n\n  const factory = useCallback(getEditor, deps)\n\n  useLayoutEffect(() => {\n    editorInfo.setEditorFactory(() => factory)\n  }, [editorInfo, factory])\n\n  return {\n    loading: editorInfo.loading,\n    get: () => editorInfo.editor.current,\n  }\n}\n","import type { Editor } from '@milkdown/kit/core'\n\nimport { useCallback, useContext } from 'react'\n\nimport { editorInfoContext } from './use-get-editor'\n\nexport type Instance = [true, () => undefined] | [false, () => Editor]\n\nexport function useInstance() {\n  const editorInfo = useContext(editorInfoContext)\n\n  const getInstance = useCallback(() => {\n    return editorInfo.editor.current\n  }, [editorInfo.editor])\n\n  return [editorInfo.loading, getInstance] as Instance\n}\n"],"names":["editor"],"mappings":";AAIO,MAAM,oBAAoB;AAAA,EAC/B,CAAA;AACF;AAEO,SAAS,eAAe;AACvB,QAAA;AAAA,IACJ;AAAA,IACA,QAAQ;AAAA,IACR;AAAA,IACA,eAAe;AAAA,EAAA,IACb,WAAW,iBAAiB;AAC1B,QAAA,SAAS,OAAuB,IAAI;AAE1C,YAAU,MAAM;AACd,UAAM,MAAM,OAAO;AAEnB,QAAI,CAAC,UAAW;AAEhB,QAAI,CAAC,IAAK;AAEV,QAAI,UAAU;AAER,UAAA,SAAS,UAAU,GAAG;AAC5B,QAAI,CAAC,OAAQ;AAEb,eAAW,IAAI;AACf,WACG,OAAO,EACP,KAAK,CAACA,YAAW;AAChB,gBAAU,UAAUA;AAAAA,IAAA,CACrB,EACA,QAAQ,MAAM;AACb,iBAAW,KAAK;AAAA,IAAA,CACjB,EACA,MAAM,QAAQ,KAAK;AAEtB,WAAO,MAAM;AACX,aAAO,QAAQ,EAAE,MAAM,QAAQ,KAAK;AAAA,IACtC;AAAA,KACC,CAAC,KAAK,WAAW,WAAW,UAAU,CAAC;AAEnC,SAAA;AACT;ACrCO,MAAM,WAAe,MAAM;AAChC,QAAM,SAAS,aAAa;AAE5B,SAAQ,sBAAA,cAAA,OAAA,EAAI,sBAAkB,MAAC,KAAK,QAAQ;AAC9C;AAEO,MAAM,mBAAgD,CAAC,EAAE,eAAe;AACvE,QAAA,MAAM,OAAmC,MAAS;AAClD,QAAA,CAAC,eAAe,gBAAgB,IAAI;AAAA,IACxC;AAAA,EACF;AACM,QAAA,SAAS,OAA2B,MAAS;AACnD,QAAM,CAAC,SAAS,UAAU,IAAI,SAAS,IAAI;AAE3C,QAAM,gBAAgB;AAAA,IACpB,OAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IAAA;AAAA,IAEF,CAAC,SAAS,aAAa;AAAA,EACzB;AAEA,6CACG,kBAAkB,UAAlB,EAA2B,OAAO,iBAChC,QACH;AAEJ;AChCO,SAAS,UACd,WACA,OAAuB,IACN;AACX,QAAA,aAAa,WAAW,iBAAiB;AAEzC,QAAA,UAAU,YAAY,WAAW,IAAI;AAE3C,kBAAgB,MAAM;AACT,eAAA,iBAAiB,MAAM,OAAO;AAAA,EAAA,GACxC,CAAC,YAAY,OAAO,CAAC;AAEjB,SAAA;AAAA,IACL,SAAS,WAAW;AAAA,IACpB,KAAK,MAAM,WAAW,OAAO;AAAA,EAC/B;AACF;AChBO,SAAS,cAAc;AACtB,QAAA,aAAa,WAAW,iBAAiB;AAEzC,QAAA,cAAc,YAAY,MAAM;AACpC,WAAO,WAAW,OAAO;AAAA,EAAA,GACxB,CAAC,WAAW,MAAM,CAAC;AAEf,SAAA,CAAC,WAAW,SAAS,WAAW;AACzC;"}