{"version":3,"file":"inline-latex-D0G71cGk.js","sources":["../../src/feature/latex/inline-latex.ts"],"sourcesContent":["import { $nodeSchema } from '@milkdown/kit/utils'\nimport katex from 'katex'\n\nexport const mathInlineId = 'math_inline'\n\n/// Schema for inline math node.\n/// Add support for:\n///\n/// ```markdown\n/// $a^2 + b^2 = c^2$\n/// ```\nexport const mathInlineSchema = $nodeSchema(mathInlineId, () => ({\n  group: 'inline',\n  inline: true,\n  draggable: true,\n  atom: true,\n  attrs: {\n    value: {\n      default: '',\n    },\n  },\n  parseDOM: [\n    {\n      tag: `span[data-type=\"${mathInlineId}\"]`,\n      getAttrs: (dom) => {\n        return {\n          value: (dom as HTMLElement).dataset.value ?? '',\n        }\n      },\n    },\n  ],\n  toDOM: (node) => {\n    const code: string = node.attrs.value\n    const dom = document.createElement('span')\n    dom.dataset.type = mathInlineId\n    dom.dataset.value = code\n    katex.render(code, dom, {\n      throwOnError: false,\n    })\n\n    return dom\n  },\n  parseMarkdown: {\n    match: (node) => node.type === 'inlineMath',\n    runner: (state, node, type) => {\n      state.addNode(type, { value: node.value as string })\n    },\n  },\n  toMarkdown: {\n    match: (node) => node.type.name === mathInlineId,\n    runner: (state, node) => {\n      state.addNode('inlineMath', undefined, node.attrs.value)\n    },\n  },\n}))\n"],"names":["$nodeSchema"],"mappings":";;;;;AAGO,MAAM,YAAe,GAAA;AAQf,MAAA,gBAAA,GAAmBA,iBAAY,CAAA,YAAA,EAAc,OAAO;AAAA,EAC/D,KAAO,EAAA,QAAA;AAAA,EACP,MAAQ,EAAA,IAAA;AAAA,EACR,SAAW,EAAA,IAAA;AAAA,EACX,IAAM,EAAA,IAAA;AAAA,EACN,KAAO,EAAA;AAAA,IACL,KAAO,EAAA;AAAA,MACL,OAAS,EAAA;AAAA;AACX,GACF;AAAA,EACA,QAAU,EAAA;AAAA,IACR;AAAA,MACE,GAAA,EAAK,mBAAmB,YAAY,CAAA,EAAA,CAAA;AAAA,MACpC,QAAA,EAAU,CAAC,GAAQ,KAAA;AAxBzB,QAAA,IAAA,EAAA;AAyBQ,QAAO,OAAA;AAAA,UACL,KAAQ,EAAA,CAAA,EAAA,GAAA,GAAA,CAAoB,OAAQ,CAAA,KAAA,KAA5B,IAAqC,GAAA,EAAA,GAAA;AAAA,SAC/C;AAAA;AACF;AACF,GACF;AAAA,EACA,KAAA,EAAO,CAAC,IAAS,KAAA;AACf,IAAM,MAAA,IAAA,GAAe,KAAK,KAAM,CAAA,KAAA;AAChC,IAAM,MAAA,GAAA,GAAM,QAAS,CAAA,aAAA,CAAc,MAAM,CAAA;AACzC,IAAA,GAAA,CAAI,QAAQ,IAAO,GAAA,YAAA;AACnB,IAAA,GAAA,CAAI,QAAQ,KAAQ,GAAA,IAAA;AACpB,IAAM,KAAA,CAAA,MAAA,CAAO,MAAM,GAAK,EAAA;AAAA,MACtB,YAAc,EAAA;AAAA,KACf,CAAA;AAED,IAAO,OAAA,GAAA;AAAA,GACT;AAAA,EACA,aAAe,EAAA;AAAA,IACb,KAAO,EAAA,CAAC,IAAS,KAAA,IAAA,CAAK,IAAS,KAAA,YAAA;AAAA,IAC/B,MAAQ,EAAA,CAAC,KAAO,EAAA,IAAA,EAAM,IAAS,KAAA;AAC7B,MAAA,KAAA,CAAM,QAAQ,IAAM,EAAA,EAAE,KAAO,EAAA,IAAA,CAAK,OAAiB,CAAA;AAAA;AACrD,GACF;AAAA,EACA,UAAY,EAAA;AAAA,IACV,KAAO,EAAA,CAAC,IAAS,KAAA,IAAA,CAAK,KAAK,IAAS,KAAA,YAAA;AAAA,IACpC,MAAA,EAAQ,CAAC,KAAA,EAAO,IAAS,KAAA;AACvB,MAAA,KAAA,CAAM,OAAQ,CAAA,YAAA,EAAc,MAAW,EAAA,IAAA,CAAK,MAAM,KAAK,CAAA;AAAA;AACzD;AAEJ,CAAE,CAAA;;;;;"}